<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>RS-CIT Test Screen</title>
  <style>
  body {
    margin: 0;
    padding: 0;
    background: #fff; /* рдмрд╛рд╣рд░ area white */
    font-family: Arial, sans-serif;
  }

  .chat-window {
    width: 380px;   /* slim window */
    height: 550px;
    background: #ffe4ec; /* light pink */
    border-radius: 12px;
    box-shadow: 0px 4px 12px rgba(0,0,0,0.2);
    margin: 20px auto;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    position: relative;
  }

  .messages {
    flex: 1;
    padding: 12px;
    overflow-y: auto;
  }

  .bot-msg {
    background: #ffb6c1;
    border-radius: 8px;
    padding: 8px 10px;
    margin: 4px 0;
    max-width: 85%;
  }

  .user-msg {
    background: #fff;
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 8px 10px;
    margin: 4px 0;
    max-width: 85%;
    align-self: flex-end;
  }

  .question-msg {
    background: #ffd1dc;
    border-radius: 8px;
    padding: 8px 10px;
    margin-top: 0; /* question aur options ke beech gap hata diya */
    max-width: 90%;
  }

  .correct-answer {
    background: #e0ffe0;
    border-left: 4px solid #4caf50;
    padding: 8px;
    margin: 4px 0;
    border-radius: 6px;
  }

  .celebration-card {
    background: #fff0f5;
    border: 2px solid #ff69b4;
    padding: 10px;
    border-radius: 10px;
    margin: 8px 0;
    text-align: center;
  }

  .celebration-card.suspense {
    background: #fff8dc;
    border: 2px dashed #ffa500;
  }

  .buttons {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    padding: 8px;
    background: #ffe4ec;
    position: sticky;
    bottom: 0;
  }

  .buttons button {
    padding: 10px;
    border: none;
    border-radius: 8px;
    background: #ff69b4;
    color: white;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.3s;
  }

  .buttons button:hover {
    background: #ff1493;
  }
</style>

<div id="chatBotArea"></div>
<div id="confetti"></div>

<script>
  let questions = [];
  let currentIndex = 0;
  let score = 0;
  let attempted = 0;
  let correct = 0;
  let userName = "Guest";

  function openChatBot() {
    const area = document.getElementById('chatBotArea');
    area.innerHTML = `
      <div id="chatContainer" class="chat-window">
        <div id="chatMessages" class="messages"></div>
        <div id="answerButtons" class="buttons">
          <button onclick="chooseAnswer('A')">A</button>
          <button onclick="chooseAnswer('B')">B</button>
          <button onclick="chooseAnswer('C')">C</button>
          <button onclick="chooseAnswer('D')">D</button>
        </div>
      </div>`;
    startChatBotTest();
  }

  function startChatBotTest() {
    google.script.run.withSuccessHandler(initChatBot)
                     .withFailureHandler(err => alert(err.message))
                     .startChatBotSession(userName);
  }

  function initChatBot(data) {
    if (data.status !== 'ok') { alert("Unable to load questions"); return; }
    questions = data.questions;
    showBotMessage(`ЁЯЩПрд░рд╛рдзреЗ рд░рд╛рдзреЗЁЯЩП, рджреЛрд╕реНрддреЛрдВ<br>ЁЯдЦ Hey Champion, ${userName}! ЁЯСЛ<br>Sunshine Bot me swagat hai тАУ<br>Practice karo, marks jeeto aur 3 August 2025 ko hone wali RS-CIT pariksha ki mazedar tarike se taiyari karo! Apni skills ko next level par le jao! ЁЯШЙ`, true);
    askNextQuestion();
  }

  function askNextQuestion() {
    if (currentIndex >= questions.length) { showSummary(); return; }
    const q = questions[currentIndex];
    showQuestionMessage(`Q${currentIndex + 1}: ${q[1]}`);
    document.querySelectorAll('#answerButtons button').forEach((btn,i) => {
      btn.textContent = `${String.fromCharCode(65+i)}. ${q[i+2]}`;
    });
  }

  function chooseAnswer(option) {
    const correctOption = questions[currentIndex][6];
    const correctText = questions[currentIndex][correctOption.charCodeAt(0) - 65 + 2];
    const selectedText = questions[currentIndex][option.charCodeAt(0) - 65 + 2];

    attempted++;
    showUserMessage(`  ЁЯСд ${userName}: ${option}. ${selectedText}`);

    if (option === correctOption) {
      score += 2; correct++;
      showBotMessage(`ЁЯдЦ Wah, ${userName}! ЁЯСЖ рд╕рд╣реА рдЬрд╡рд╛рдм! (+2 Marks) | Total: ${score} Marks`, false, 'correct');
      launchConfetti();
      if (score === 28) showCelebrationCard(userName);
    } else {
      showBotMessage(`ЁЯдЦ Oops, ${userName}! ЁЯСЖ рдЧрд▓рдд рдЬрд╡рд╛рдм. | Total: ${score} Marks`, false, 'wrong');
      showCorrectAnswer(`ЁЯдЦ рд╕рд╣реА рдЬрд╡рд╛рдм рд╣реИЁЯСЙ: ${correctOption}. ${correctText}`);
    }

    checkMilestones();
    currentIndex++; setTimeout(askNextQuestion, 2000); // рдЕрдЧрд▓рд╛ question 2 sec delay рд╕реЗ
  }

  function checkMilestones() {
    const marks = score;
    const correctQs = correct;
    if (marks === 42) {
      showCustomCelebration("ЁЯОЙ Shabash Champion!",
        "Aapne First Division (42 Marks) hasil kar li hai тАУ Hard Work ka Result!<br>Ab Agla Target тАУ <b>Top Rank!</b> ЁЯЪА");
    } 
    else if (marks === 50) {
      showCustomCelebration("ЁЯФе Excellent!",
        "Aapne 25 Questions Correct (50 Marks) ka milestone achieve kiya hai!<br>Next Goal тАУ <b>30 Questions!</b> Keep Going, Winner! ЁЯМЯ");
    } 
    else if (marks === 60) {
      showCustomCelebration("ЁЯМЯ Outstanding!",
        "Aapne 30 Questions Correct (60 Marks) se ek aur Level Cross kiya!<br>Ab <b>Topper List</b> ke liye Ready Raho тАУ Keep the Speed! ЁЯЪА");
    } 
    else if (marks === 70) {
      showCustomCelebration("ЁЯОК Incredible! Sabhi 35 Questions Sahi!",
        "Aapne Perfect Champion ban kar <b>Record Tod Diya!</b> ЁЯПЖ<br>Sabse Bada Jashn тАУ Claps & Cheers! ЁЯОЙ");
    } 
    else if (correctQs >= 31 && correctQs <= 34) {
      const suspenseLines = [
        "тЪб Bas Thoda Sa AurтАж Record Tootne Wala Hai?",
        "ЁЯФе Kya Aapka Naam Topper List Mein Aane Wala Hai?",
        "ЁЯМЯ Sirf 1 Question Ka Fark тАУ Champion Ban Sakte Ho!",
        "ЁЯЪА Focus Rakho тАУ Victory Pass Hi Hai!"
      ];
      const randomLine = suspenseLines[Math.floor(Math.random() * suspenseLines.length)];
      showCustomCelebration("Suspense Mode", randomLine, true);
    }
  }

  function showSummary() {
    showBotMessage(`ЁЯдЦ Practice Complete, ${userName}!`);
    showBotMessage(`тЬФ Attempted: ${attempted}<br>тЬФ Correct: ${correct}<br>тЬФ Marks: ${score}`);
    if (score < 50) {
      showCustomCelebration("Motivation Time!", 
        "рд╣рд░ рдХреЛрд╢рд┐рд╢ рдорд╛рдпрдиреЗ рд░рдЦрддреА рд╣реИ! ЁЯТк<br>рдЗрд╕ рдмрд╛рд░ рдкрд░рд┐рдгрд╛рдо 42 рд╕реЗ рдХрдо рдЖрдпрд╛, рд▓реЗрдХрд┐рди рдпрд╣реА рд╕реЗ рд╕реАрдЦрдХрд░ рдЕрдЧрд▓реА рдмрд╛рд░ рдФрд░ рдордЬрдмреВрдд рд╡рд╛рдкрд╕реА рдХрд░реЛред<br>рд╣рд╛рд░ рдордд рдорд╛рдиреЛ тАУ рдЕрдЧрд▓рд╛ рдЯреЗрд╕реНрдЯ рддреБрдореНрд╣рд╛рд░реА рдЬреАрдд рдХреА рд╢реБрд░реБрдЖрдд рд╣реЛ рд╕рдХрддрд╛ рд╣реИ!");
    } 
    else if (score >= 50 && score <= 60) {
      showCustomCelebration("рд╢рд╛рдирджрд╛рд░! ЁЯОЙ", 
        "50+ Marks тАУ рдпрд╣ рд╕рд╛рдмрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЖрдк рд╕рд╣реА рд░рд╛рд╣ рдкрд░ рд╣реЛред<br>рдЕрдм рдмрд╕ рдереЛрдбрд╝реА рдФрд░ рдореЗрд╣рдирдд рд╕реЗ 60+ рдФрд░ рдлрд┐рд░ Top Scores рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реЛ!");
    } 
    else if (score >= 62 && score <= 68) {
      showCustomCelebration("рдХрдорд╛рд▓ рдХрд░ рджрд┐рдпрд╛! ЁЯЪА", 
        "62+ Marks тАУ рдЕрдм рдЖрдк Top Performers рдХреА рд▓рд┐рд╕реНрдЯ рдореЗрдВ рд╣реЛред<br>рдмрд╕ рдереЛрдбрд╝реА рдФрд░ рдлреЛрдХрд╕ рдФрд░ рдореЗрд╣рдирдд тАУ рдЕрдЧрд▓реА рдмрд╛рд░ Perfect 70/70 рдЖрдкрдХрд╛ рд╣реЛрдЧрд╛!");
    } 
    else if (score === 70) {
      showCustomCelebration("ЁЯФе рдЕрд╡рд┐рд╢реНрд╡рд╕рдиреАрдп! 70/70 тАУ рдЖрдк рд╣реИрдВ Sunshine Champion!", 
        "рдЖрдкрдХреА рдореЗрд╣рдирдд, Focus рдФрд░ Dedication рдХрд╛ рдпрд╣ рд╢рд╛рдирджрд╛рд░ рдирддреАрдЬрд╛ рд╣реИред<br>рдЕрдм рдЖрдк рджреВрд╕рд░реЛрдВ рдХреЗ рд▓рд┐рдП Inspiration рдмрди рдЪреБрдХреЗ рд╣реИрдВ тАУ Keep Shining! ЁЯМЯ");
    }
    showBotMessage(`ЁЯФе Kal fir se naye questions ke sath wapas aaiye aur streak banaiye! ЁЯМЯ`);
  }

  function showBotMessage(msg, isWelcome=false, type='') {
    const chat = document.getElementById('chatMessages');
    let extraClass = '';
    if (type === 'correct') extraClass = 'correct';
    else if (type === 'wrong') extraClass = 'wrong';
    chat.innerHTML += `<div class="bot-msg ${isWelcome ? 'welcome' : ''} ${extraClass}">${msg}</div>`;
    chat.scrollTop = chat.scrollHeight;
  }

  function showUserMessage(msg) {
    const chat = document.getElementById('chatMessages');
    chat.innerHTML += `<div class="user-msg">${msg}</div>`;
    chat.scrollTop = chat.scrollHeight;
  }

  function showQuestionMessage(msg) {
    const chat = document.getElementById('chatMessages');
    chat.innerHTML += `<div class="question-msg">${msg}</div>`;
    chat.scrollTop = chat.scrollHeight;
  }

  function showCorrectAnswer(msg) {
    const chat = document.getElementById('chatMessages');
    chat.innerHTML += `<div class="correct-answer">${msg}</div>`;
    chat.scrollTop = chat.scrollHeight;
  }

  function showCustomCelebration(title, message, isSuspense=false) {
    const chat = document.getElementById('chatMessages');
    chat.innerHTML += `
      <div class="celebration-card ${isSuspense ? 'suspense' : ''}">
        <h3>${title}</h3>
        <p>${message}</p>
      </div>`;
    chat.scrollTop = chat.scrollHeight;
    for (let i = 0; i < 2; i++) setTimeout(launchConfetti, i * 500);
  }

  function launchConfetti() {
    const confetti = document.getElementById('confetti');
    for (let i = 0; i < 16; i++) {
      const div = document.createElement('div');
      div.style.position = 'absolute';
      div.style.width = `${6+Math.random()*6}px`;
      div.style.height = div.style.width;
      div.style.backgroundColor = `hsl(${Math.random()*360},100%,70%)`;
      div.style.top = '-10px';
      div.style.left = `${Math.random()*100}%`;
      div.style.opacity = 1;
      confetti.appendChild(div);
      const fall = div.animate([
        { transform: `translateY(0) rotate(0deg)`, opacity: 1 },
        { transform: `translateY(100vh) rotate(${720+Math.random()*360}deg)`, opacity: 0 }
      ], { duration: 2000 + Math.random()*1000, easing: 'ease-out' });
      fall.onfinish = () => div.remove();
    }
  }

  function showCelebrationCard(name) {
    const chat = document.getElementById('chatMessages');
    chat.innerHTML += `
      <div class="celebration-card">
        <h3>ЁЯОЙ Dear ${name},</h3>
        <p>RS-CIT рдкрд░реАрдХреНрд╖рд╛ рдкрд╛рд╕ рдХрд░рдиреЗ рдЬрд┐рддрдиреЗ Marks рдЖрдкрдиреЗ рдЗрд╕ рдкреНрд░реИрдХреНрдЯрд┐рд╕ рдЯреЗрд╕реНрдЯ рдореЗрдВ рд╣рд╛рд╕рд┐рд▓ рдХрд┐рдП!</p>
        <p style="margin-top:6px;">рдЕрдм рд▓рдХреНрд╖реНрдп рд╣реИ тАУ <b>рд╕рдмрд╕реЗ рдмреЗрд╣рддрд░реАрди Marks</b> рдкрд╛рдирд╛!</p>
        <p>"рдЬрд╝реНрдпрд╛рджрд╛ рдкреНрд░реИрдХреНрдЯрд┐рд╕ = рд╢рд╛рдирджрд╛рд░ рд░рд┐рдЬрд╝рд▓реНрдЯ!" ЁЯМЯ</p>
        <p>"Next Level Practice = Top Result!" ЁЯМЯ</p>
        <p>"рдЕрдм рдЕрдЧрд▓рд╛ рдкреНрд░рд╢реНрди рд╣рд▓ рдХрд░реЗрдВ ЁЯСЗ" ЁЯМЯ</p>
      </div>`;
    chat.scrollTop = chat.scrollHeight;
    for (let i = 0; i < 3; i++) setTimeout(launchConfetti, i * 500);
  }

  // Start
  openChatBot();
</script>

</body>
</html>
